/**
 * Configuration Integration Example
 *
 * This file demonstrates how to use the configuration system
 * in different parts of your application.
 */

// ============================================================================
// Example 1: Using configuration in a React component
// ============================================================================

import { useAgentConfig, useSwapConfig, useTransactionSafety } from '@/hooks/useAgentConfig';

export function SwapComponentExample() {
  // Get full config access
  const { config, getTokenConfig, validatePriceImpact } = useAgentConfig();

  // Or use specific config hooks
  const swapConfig = useSwapConfig();
  const safety = useTransactionSafety();

  // Access agent name
  const agentName = config.agent.name;

  // Get default slippage
  const defaultSlippage = swapConfig.defaultSlippage;

  // Get token configuration
  const usdcToken = getTokenConfig('USDC');

  // Validate price impact
  const priceImpact = 7.5;
  const validation = validatePriceImpact(priceImpact);

  return (
    <div>
      <h1>{agentName}</h1>
      <p>Default Slippage: {defaultSlippage}%</p>

      {usdcToken && (
        <div>
          <p>Token: {usdcToken.name}</p>
          <p>Address: {usdcToken.address}</p>
          <p>Decimals: {usdcToken.decimals}</p>
        </div>
      )}

      {validation.level === 'warning' && (
        <div className="warning">
          {validation.message}
        </div>
      )}

      {validation.shouldBlock && (
        <div className="error">
          Transaction blocked: {validation.message}
        </div>
      )}
    </div>
  );
}

// ============================================================================
// Example 2: Conditional rendering based on feature flags
// ============================================================================

import { useFeature } from '@/hooks/useAgentConfig';

export function FeatureFlagExample() {
  // Check if feature is enabled
  const showHistory = useFeature('features.beta.transaction_history');
  const showCharts = useFeature('features.beta.advanced_charts');

  return (
    <div>
      {showHistory && (
        <TransactionHistory />
      )}

      {showCharts && (
        <AdvancedCharts />
      )}

      {!showHistory && (
        <div>Transaction history coming soon!</div>
      )}
    </div>
  );
}

// ============================================================================
// Example 3: Using configuration in API routes
// ============================================================================

import { NextResponse } from 'next/server';
import {
  getConfig,
  getSystemPrompt,
  getTimeout,
  getRetryConfig,
  getErrorMessage
} from '@/lib/config';

export async function POST(request: Request) {
  try {
    // Get AI model configuration
    const model = getConfig<string>('capabilities.natural_language.model');
    const temperature = getConfig<number>('capabilities.natural_language.temperature');
    const maxTokens = getConfig<number>('capabilities.natural_language.max_tokens');

    // Get timeout
    const timeout = getTimeout('chat_response_ms');

    // Get system prompt
    const systemPrompt = getSystemPrompt();

    // Get retry configuration
    const retryConfig = getRetryConfig();

    // Make API call with configuration
    const response = await fetch('https://api.example.com', {
      method: 'POST',
      body: JSON.stringify({
        model,
        temperature,
        max_tokens: maxTokens,
        system: systemPrompt,
      }),
      signal: AbortSignal.timeout(timeout),
    });

    return NextResponse.json({ success: true });

  } catch (error) {
    // Use configured error message
    const errorMessage = getErrorMessage('api_error', 'Something went wrong');

    return NextResponse.json(
      { error: errorMessage },
      { status: 500 }
    );
  }
}

// ============================================================================
// Example 4: Token selection with configuration
// ============================================================================

import { useTokens, useNetwork } from '@/hooks/useAgentConfig';

export function TokenSelectorExample() {
  // Get current network (defaults to default network)
  const network = useNetwork();

  // Get tokens for current network
  const tokens = useTokens(network?.chain_id);

  // Get all tokens (all chains)
  const allTokens = useTokens();

  return (
    <div>
      <h2>Available Tokens on {network?.name}</h2>
      <select>
        {tokens.map(token => (
          <option key={token.address} value={token.address}>
            {token.symbol} - {token.name}
          </option>
        ))}
      </select>

      <h3>All Supported Tokens</h3>
      <ul>
        {allTokens.map(token => (
          <li key={`${token.chain_id}-${token.address}`}>
            {token.symbol} on Chain {token.chain_id}
          </li>
        ))}
      </ul>
    </div>
  );
}

// ============================================================================
// Example 5: Network switching with configuration
// ============================================================================

import { useNetwork, useAgentConfig } from '@/hooks/useAgentConfig';
import { useAccount, useSwitchChain } from 'wagmi';

export function NetworkSwitcherExample() {
  const { chain } = useAccount();
  const { switchChain } = useSwitchChain();
  const { blockchain } = useAgentConfig();

  // Get all enabled networks
  const enabledNetworks = blockchain.networks.filter(n => n.enabled);

  // Get default network
  const defaultNetwork = blockchain.networks.find(n => n.default);

  // Check if on correct network
  const isCorrectNetwork = chain?.id === blockchain.default_network_id;

  return (
    <div>
      {!isCorrectNetwork && (
        <div className="warning">
          Please switch to {defaultNetwork?.name}
          <button onClick={() => switchChain({ chainId: blockchain.default_network_id })}>
            Switch Network
          </button>
        </div>
      )}

      <h3>Available Networks</h3>
      {enabledNetworks.map(network => (
        <button
          key={network.chain_id}
          onClick={() => switchChain({ chainId: network.chain_id })}
          disabled={chain?.id === network.chain_id}
        >
          {network.name} {network.default && '(Default)'}
        </button>
      ))}
    </div>
  );
}

// ============================================================================
// Example 6: Custom prompts and messages
// ============================================================================

import { usePrompts } from '@/hooks/useAgentConfig';
import { useState, useEffect } from 'react';

export function WelcomeMessageExample() {
  const { welcomeMessage, disclaimer, getErrorMessage } = usePrompts();
  const [showDisclaimer, setShowDisclaimer] = useState(true);

  // Show welcome message on mount
  useEffect(() => {
    alert(welcomeMessage);
  }, [welcomeMessage]);

  return (
    <div>
      {showDisclaimer && (
        <div className="disclaimer">
          {disclaimer}
          <button onClick={() => setShowDisclaimer(false)}>
            I Understand
          </button>
        </div>
      )}

      {/* Use error messages */}
      <div className="error">
        {getErrorMessage('wallet_not_connected')}
      </div>
    </div>
  );
}

// ============================================================================
// Example 7: Price impact validation
// ============================================================================

import { useTransactionSafety } from '@/hooks/useAgentConfig';
import { useState } from 'react';

export function PriceImpactExample() {
  const { validatePriceImpact, priceImpactWarningThreshold } = useTransactionSafety();
  const [priceImpact, setPriceImpact] = useState(0);

  const validation = validatePriceImpact(priceImpact);

  return (
    <div>
      <input
        type="number"
        value={priceImpact}
        onChange={(e) => setPriceImpact(parseFloat(e.target.value))}
        placeholder="Enter price impact %"
      />

      {validation.level === 'safe' && (
        <div className="text-green-600">
          ‚úì Safe price impact
        </div>
      )}

      {validation.level === 'warning' && (
        <div className="text-yellow-600">
          ‚ö†Ô∏è {validation.message}
        </div>
      )}

      {validation.level === 'danger' && (
        <div className="text-red-600">
          üõë {validation.message}
          {validation.shouldBlock && (
            <p>This transaction will be blocked.</p>
          )}
        </div>
      )}

      <p className="text-sm text-gray-500">
        Warning threshold: {priceImpactWarningThreshold}%
      </p>
    </div>
  );
}

// ============================================================================
// Example 8: Slippage configuration
// ============================================================================

import { useSwapConfig } from '@/hooks/useAgentConfig';
import { useState } from 'react';

export function SlippageConfigExample() {
  const { defaultSlippage, minSlippage, maxSlippage } = useSwapConfig();
  const [slippage, setSlippage] = useState(defaultSlippage);

  const handleSlippageChange = (value: number) => {
    if (value < minSlippage) {
      alert(`Minimum slippage is ${minSlippage}%`);
      return;
    }
    if (value > maxSlippage) {
      alert(`Maximum slippage is ${maxSlippage}%`);
      return;
    }
    setSlippage(value);
  };

  return (
    <div>
      <label>
        Slippage Tolerance: {slippage}%
      </label>

      <input
        type="range"
        min={minSlippage}
        max={maxSlippage}
        step={0.1}
        value={slippage}
        onChange={(e) => handleSlippageChange(parseFloat(e.target.value))}
      />

      <div className="presets">
        <button onClick={() => setSlippage(0.1)}>0.1%</button>
        <button onClick={() => setSlippage(0.5)}>0.5%</button>
        <button onClick={() => setSlippage(1.0)}>1.0%</button>
        <button onClick={() => setSlippage(defaultSlippage)}>
          Default ({defaultSlippage}%)
        </button>
      </div>

      <p className="text-sm">
        Valid range: {minSlippage}% - {maxSlippage}%
      </p>
    </div>
  );
}

// ============================================================================
// Example 9: UI configuration
// ============================================================================

import { useUIConfig } from '@/hooks/useAgentConfig';

export function ThemedComponentExample() {
  const { theme, notifications, onboarding } = useUIConfig();

  return (
    <div
      style={{
        backgroundColor: theme.mode === 'dark' ? '#1a1a1a' : '#ffffff',
        color: theme.mode === 'dark' ? '#ffffff' : '#000000',
      }}
    >
      <button
        style={{
          backgroundColor: theme.primary_color,
          color: '#ffffff',
        }}
      >
        Primary Action
      </button>

      <button
        style={{
          backgroundColor: theme.accent_color,
          color: '#ffffff',
        }}
      >
        Secondary Action
      </button>

      {onboarding.show_welcome_message && (
        <WelcomeModal />
      )}

      {notifications.enabled && (
        <NotificationContainer
          position={notifications.position}
          duration={notifications.duration_ms}
        />
      )}
    </div>
  );
}

// ============================================================================
// Example 10: API configuration with retry logic
// ============================================================================

import { useAPIConfig } from '@/hooks/useAgentConfig';

export async function fetchWithRetryExample() {
  const { getRetryConfig, getTimeout } = useAPIConfig();
  const retryConfig = getRetryConfig();
  const timeout = getTimeout('quote_fetch_ms');

  let lastError: Error | null = null;

  for (let attempt = 0; attempt < retryConfig.maxAttempts; attempt++) {
    try {
      const response = await fetch('https://api.example.com', {
        signal: AbortSignal.timeout(timeout),
      });

      if (response.ok) {
        return await response.json();
      }

      throw new Error(`HTTP ${response.status}`);

    } catch (error) {
      lastError = error as Error;

      if (attempt < retryConfig.maxAttempts - 1) {
        const delay = retryConfig.initialDelay * Math.pow(retryConfig.backoffMultiplier, attempt);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }

  throw lastError;
}

// ============================================================================
// Example 11: Maintenance mode check
// ============================================================================

import { useAgentConfig } from '@/hooks/useAgentConfig';

export function MaintenanceModeExample() {
  const { maintenance } = useAgentConfig();

  if (maintenance.mode) {
    return (
      <div className="maintenance-page">
        <h1>Maintenance Mode</h1>
        <p>{maintenance.message}</p>
        {maintenance.estimated_duration_minutes > 0 && (
          <p>Estimated duration: {maintenance.estimated_duration_minutes} minutes</p>
        )}
      </div>
    );
  }

  return <NormalApplication />;
}

// ============================================================================
// Example 12: Logging with configuration
// ============================================================================

import { getConfig } from '@/lib/config';

export class Logger {
  private level: 'debug' | 'info' | 'warn' | 'error';
  private includeTimestamps: boolean;
  private includeStackTraces: boolean;

  constructor() {
    const logging = getConfig<{
      level: 'debug' | 'info' | 'warn' | 'error';
      include_timestamps: boolean;
      include_stack_traces: boolean;
    }>('logging');

    this.level = logging.level;
    this.includeTimestamps = logging.include_timestamps;
    this.includeStackTraces = logging.include_stack_traces;
  }

  private shouldLog(level: string): boolean {
    const levels = ['debug', 'info', 'warn', 'error'];
    const currentIndex = levels.indexOf(this.level);
    const requestedIndex = levels.indexOf(level);
    return requestedIndex >= currentIndex;
  }

  private format(level: string, message: string, error?: Error): string {
    let output = '';

    if (this.includeTimestamps) {
      output += `[${new Date().toISOString()}] `;
    }

    output += `[${level.toUpperCase()}] ${message}`;

    if (error && this.includeStackTraces) {
      output += `\n${error.stack}`;
    }

    return output;
  }

  debug(message: string): void {
    if (this.shouldLog('debug')) {
      console.debug(this.format('debug', message));
    }
  }

  info(message: string): void {
    if (this.shouldLog('info')) {
      console.info(this.format('info', message));
    }
  }

  warn(message: string): void {
    if (this.shouldLog('warn')) {
      console.warn(this.format('warn', message));
    }
  }

  error(message: string, error?: Error): void {
    if (this.shouldLog('error')) {
      console.error(this.format('error', message, error));
    }
  }
}

// Usage
const logger = new Logger();
logger.info('Application started');
logger.debug('Debug information');
logger.error('Error occurred', new Error('Something went wrong'));

// ============================================================================
// Dummy components for examples
// ============================================================================

function TransactionHistory() { return <div>Transaction History</div>; }
function AdvancedCharts() { return <div>Advanced Charts</div>; }
function WelcomeModal() { return <div>Welcome Modal</div>; }
function NotificationContainer(props: { position: string; duration: number }) {
  return <div>Notifications</div>;
}
function NormalApplication() { return <div>App</div>; }
